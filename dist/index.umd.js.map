{"version":3,"file":"index.umd.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'keydown->keydown'],\n    ['element', 'tree:expand->expand'],\n    ['element', 'tree:collapse->collapse']\n  ];\n\n  get nodes() {\n    return Array.from(this.element.querySelectorAll('li'));\n  }\n\n  get icons() {\n    return Array.from(this.element.querySelectorAll('a[href=\"#icon\"]'));\n  }\n\n  get openedNodes() {\n    return Array.from(this.element.querySelectorAll('li:not(.st-tree__node--closed)'));\n  }\n\n  get visibleNodes() {\n    return this.nodes.filter(node => !node.parentNode.closest('li.st-tree__node--closed'));\n  }\n\n  get visibleIcons() {\n    return this.visibleNodes.filter(node => !node.matches('.st-tree__node--leaf')).map(node => this.findIcon(node));\n  }\n  \n  connect() {\n    this.init();\n    this.load();\n  }\n\n  init() {\n    this.nodes.forEach(node => {\n      if (!node.querySelector('ul')) {\n        node.classList.add('st-tree__node--leaf', 'st-tree__node--closed');\n      }\n    });\n  }\n\n  load() {\n    let ids = this.loadStates();\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.nodes.forEach(node => {\n      if (idSet.has(node.getAttribute('data-node-id'))) {\n        this.show(node);\n      } else {\n        this.hide(node);\n      }\n    });\n  }\n\n  toggle(e) {\n    if (!e.target.matches('a[href=\"#icon\"]')) return;\n\n    let node = e.target.parentNode;\n    if (node.matches('.st-tree__node--closed')) {\n      this.open(node);\n    } else {\n      this.close(node);\n    }\n\n    e.preventDefault();\n  }\n\n  expand(e) {\n    this.nodes.forEach(node => this.show(node));\n    this.saveStates();\n  }\n\n  collapse(e) {\n    this.nodes.forEach(node => this.hide(node));\n    this.saveStates();\n  }\n\n  open(node) {\n    this.show(node);\n    this.saveStates();\n    this.dispatch('opened', { detail: { node: node } });\n  }\n\n  close(node) {\n    this.hide(node);\n    this.saveStates();\n    this.dispatch('closed', { detail: { node: node } });\n  }\n\n  show(node) {\n    node.classList.remove('st-tree__node--closed');\n  }\n\n  hide(node) {\n    node.classList.add('st-tree__node--closed');\n  }\n  \n  loadStates() {\n    if (!this.storeKeyValue) return;\n\n    let json = sessionStorage.getItem(this.storeKeyValue);\n    return json ? JSON.parse(json) : null;\n  }\n\n  saveStates() {\n    if (!this.storeKeyValue) return;\n\n    let ids = this.openedNodes.map(node => node.getAttribute('data-node-id'));\n    sessionStorage.setItem(this.storeKeyValue, JSON.stringify(ids));\n  }\n\n  keydown(e) {\n    if (!e.target.matches('a[href=\"#icon\"]')) return;\n\n    let node = e.target.parentNode;\n\n    switch (e.keyCode) {\n    case 37: // left\n      this.moveLeft(node);\n      e.preventDefault();\n      break;\n    case 38: // up\n      this.moveUp(node);\n      e.preventDefault();\n      break;\n    case 39: // right\n      this.moveRight(node);\n      e.preventDefault();\n      break;\n    case 40: // down\n      this.moveDown(node);\n      e.preventDefault();\n      break;\n    }\n  }\n\n  moveUp(node) {\n    let icons = this.visibleIcons;\n    let index = icons.indexOf(this.findIcon(node)) - 1;\n    if (index >= 0 && icons[index]) icons[index].focus();\n  }\n\n  moveDown(node) {\n    let icons = this.visibleIcons;\n    let index = icons.indexOf(this.findIcon(node)) + 1;\n    if (index >= 0 && icons[index]) icons[index].focus();\n  }\n\n  moveRight(node) {\n    if (!node.matches('.st-tree__node--closed')) {\n      let icon = this.findIcon(node.querySelector('ul:first-of-type > li:first-of-type'));\n      if (icon) icon.focus();\n    } else {\n      this.open(node);\n    }\n  }\n\n  moveLeft(node) {\n    if (node.matches('.st-tree__node--closed')) {\n      let icon = this.findIcon(node.parentNode.parentNode)\n      if (icon) icon.focus();\n    } else {\n      this.close(node);\n    }\n  }\n\n  findIcon(node) {\n    return node.querySelector('a[href=\"#icon\"]');\n  }\n}\n"],"names":["Controller","nodes","Array","from","this","element","querySelectorAll","icons","openedNodes","visibleNodes","filter","node","parentNode","closest","visibleIcons","matches","map","findIcon","connect","init","load","forEach","querySelector","classList","add","ids","loadStates","idSet","Set","has","getAttribute","show","hide","toggle","e","target","open","close","preventDefault","expand","saveStates","collapse","dispatch","detail","remove","storeKeyValue","json","sessionStorage","getItem","JSON","parse","setItem","stringify","keydown","keyCode","moveLeft","moveUp","moveRight","moveDown","index","indexOf","focus","icon","values","storeKey","String","actions"],"mappings":"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"}