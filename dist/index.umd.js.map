{"version":3,"file":"index.umd.js","sources":["../src/keyboard.js","../src/index.js"],"sourcesContent":["export default class Keyboard {\r\n  constructor(controller) {\r\n    this.controller = controller;\r\n  }\r\n\r\n  get nodes() {\r\n    return this.controller.nodes;\r\n  }\r\n\r\n  get visibleNodes() {\r\n    return this.nodes.filter(node => !node.parentNode.closest('li.st-tree__node--closed'));\r\n  }\r\n\r\n  get visibleIcons() {\r\n    return this.visibleNodes.filter(node => !node.matches('.st-tree__node--leaf')).map(node => this.findIcon(node));\r\n  }\r\n\r\n  keydown(e) {\r\n    if (!e.target.matches('a[href=\"#icon\"]')) return;\r\n\r\n    let node = e.target.parentNode;\r\n\r\n    switch (e.keyCode) {\r\n    case 37: // left\r\n      this.moveLeft(node);\r\n      e.preventDefault();\r\n      break;\r\n    case 38: // up\r\n      this.moveUp(node);\r\n      e.preventDefault();\r\n      break;\r\n    case 39: // right\r\n      this.moveRight(node);\r\n      e.preventDefault();\r\n      break;\r\n    case 40: // down\r\n      this.moveDown(node);\r\n      e.preventDefault();\r\n      break;\r\n    }\r\n  }\r\n\r\n  moveUp(node) {\r\n    let icons = this.visibleIcons;\r\n    let index = icons.indexOf(this.findIcon(node)) - 1;\r\n    if (index >= 0 && icons[index]) icons[index].focus();\r\n  }\r\n\r\n  moveDown(node) {\r\n    let icons = this.visibleIcons;\r\n    let index = icons.indexOf(this.findIcon(node)) + 1;\r\n    if (index >= 0 && icons[index]) icons[index].focus();\r\n  }\r\n\r\n  moveRight(node) {\r\n    if (!node.matches('.st-tree__node--closed')) {\r\n      let icon = this.findIcon(node.querySelector('ul:first-of-type > li:first-of-type'));\r\n      if (icon) icon.focus();\r\n    } else {\r\n      this.controller.open(node);\r\n    }\r\n  }\r\n\r\n  moveLeft(node) {\r\n    if (node.matches('.st-tree__node--closed')) {\r\n      let icon = this.findIcon(node.parentNode.parentNode)\r\n      if (icon) icon.focus();\r\n    } else {\r\n      this.controller.close(node);\r\n    }\r\n  }\r\n\r\n  findIcon(node) {\r\n    return node.querySelector('a[href=\"#icon\"]');\r\n  }\r\n}\r\n","import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport Keyboard from './keyboard';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'keydown->keydown'],\n    ['element', ':expand->expand'],\n    ['element', ':collapse->collapse']\n  ];\n\n  get nodes() {\n    return this.scope.findAllElements('li');\n  }\n\n  get openedNodes() {\n    return this.scope.findAllElements('li:not(.st-tree__node--closed)');\n  }\n  \n  connect() {\n    this.init();\n    this.load();\n    this.keyboard = new Keyboard(this);\n  }\n\n  init() {\n    this.nodes.forEach(node => {\n      if (!this.hasChildren(node)) {\n        node.classList.add('st-tree__node--leaf', 'st-tree__node--closed');\n      }\n    });\n  }\n\n  load() {\n    let ids = this.loadStates();\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.nodes.forEach(node => {\n      if (idSet.has(node.getAttribute('data-node-id'))) {\n        this.show(node);\n      } else {\n        this.hide(node);\n      }\n    });\n  }\n\n  toggle(e) {\n    if (!e.target.matches('a[href=\"#icon\"]')) return;\n\n    let node = e.target.parentNode;\n    if (node.matches('.st-tree__node--closed')) {\n      this.open(node);\n    } else {\n      this.close(node);\n    }\n\n    e.preventDefault();\n  }\n\n  expand(e) {\n    this.nodes.forEach(node => this.show(node));\n    this.saveStates();\n  }\n\n  collapse(e) {\n    this.nodes.forEach(node => this.hide(node));\n    this.saveStates();\n  }\n\n  keydown(e) {\n    this.keyboard.keydown(e);\n  }\n\n  open(node) {\n    this.show(node);\n    this.saveStates();\n    this.dispatch('opened', { detail: { node: node } });\n  }\n\n  close(node) {\n    this.hide(node);\n    this.saveStates();\n    this.dispatch('closed', { detail: { node: node } });\n  }\n\n  show(node) {\n    node.classList.remove('st-tree__node--closed');\n  }\n\n  hide(node) {\n    node.classList.add('st-tree__node--closed');\n  }\n\n  hasChildren(node) {\n    return Array.from(node.children).some(child => child.matches('ul'));\n  }\n\n  loadStates() {\n    if (!this.storeKeyValue) return;\n\n    let json = sessionStorage.getItem(this.storeKeyValue);\n    return json ? JSON.parse(json) : null;\n  }\n\n  saveStates() {\n    if (!this.storeKeyValue) return;\n\n    let ids = this.openedNodes.map(node => node.getAttribute('data-node-id'));\n    sessionStorage.setItem(this.storeKeyValue, JSON.stringify(ids));\n  }\n}\n"],"names":["Keyboard","constructor","controller","this","nodes","visibleNodes","filter","node","parentNode","closest","visibleIcons","matches","map","findIcon","keydown","e","target","keyCode","moveLeft","preventDefault","moveUp","moveRight","moveDown","icons","index","indexOf","focus","open","icon","querySelector","close","Controller","scope","findAllElements","openedNodes","connect","init","load","keyboard","forEach","hasChildren","classList","add","ids","loadStates","idSet","Set","has","getAttribute","show","hide","toggle","expand","saveStates","collapse","dispatch","detail","remove","Array","from","children","some","child","storeKeyValue","json","sessionStorage","getItem","JSON","parse","setItem","stringify","values","storeKey","String","actions"],"mappings":"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"}